<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KDZ Ai Music Creator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary: #864bff; /* Main purple */
            --primary-light: #a375ff;
            --primary-dark: #6a30d9;
            --secondary: #ff9900; /* Accent orange */
            --secondary-light: #ffb84d;
            --dark: #121212; 
            --gray-dark: #282828; 
            --gray: #535353; 
            --gray-light: #b3b3b3; 
            --gray-lighter: #e0e0e0; 
            --gray-bg: #f5f5f5; 
            --white: #ffffff;
            --success: #1db954; 
            --danger: #d93030;
            --info: #2979ff;
            --warning: #ffc107;
            --gradient-primary: linear-gradient(135deg, var(--primary-light), var(--primary));
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.1);
            --border-radius-sm: 6px;
            --border-radius-md: 10px;
            --border-radius-lg: 16px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--gray-bg);
            color: var(--dark);
            height: 100vh;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 280px; /* Increased width slightly for more items */
            background-color: var(--white);
            border-right: 1px solid var(--gray-lighter);
            display: flex;
            flex-direction: column;
            height: 100%;
            box-shadow: var(--shadow-md);
            transition: width 0.3s ease;
            z-index: 100; /* Ensure sidebar is above content on mobile */
        }
        
        .logo-container {
            padding: 22px 20px;
            border-bottom: 1px solid var(--gray-lighter);
            display: flex;
            align-items: center;
        }
        
        .logo {
            font-size: 22px;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
        }
        
        .logo-icon {
            margin-right: 10px;
            font-size: 24px;
            color: var(--primary);
        }
        
        .nav-container {
            flex: 1;
            overflow-y: auto;
            padding: 16px 0;
        }
        
        .nav-section {
            margin-bottom: 20px;
        }
        
        .section-title {
            font-weight: 600;
            padding: 0 20px 10px;
            font-size: 12px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            display: flex;
            align-items: center;
        }
        
        .nav-item {
            padding: 10px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            color: var(--gray-dark);
            transition: all 0.2s ease-in-out;
            position: relative;
            border-left: 4px solid transparent;
        }
        
        .nav-item:hover {
            background-color: var(--gray-bg);
            color: var(--primary);
            border-left-color: var(--primary-light);
        }
        
        .nav-item.active {
            background-color: rgba(134, 75, 255, 0.08);
            color: var(--primary);
            font-weight: 600;
            border-left-color: var(--primary);
        }
        
        .nav-item.active .nav-icon {
            color: var(--primary);
        }
        
        .nav-icon {
            margin-right: 14px;
            width: 20px;
            text-align: center;
            font-size: 16px;
            color: var(--gray);
            transition: color 0.2s ease-in-out;
        }

        .nav-item:hover .nav-icon {
            color: var(--primary);
        }
        
        .divider {
            border-top: 1px solid var(--gray-lighter);
            margin: 16px 20px;
        }
        
        .badge {
            background-color: var(--primary);
            color: var(--white);
            padding: 2px 8px;
            border-radius: var(--border-radius-sm);
            font-size: 10px;
            margin-left: auto;
            font-weight: 600;
        }
        
        .section-note {
            font-size: 12px;
            color: var(--gray);
            margin: 8px 20px 0;
            padding: 10px;
            background-color: rgba(134, 75, 255, 0.05);
            border-radius: var(--border-radius-sm);
            line-height: 1.5;
        }
        
        /* Main Content Styles */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden; 
            background-color: #f9f9fc; 
        }
        
        .content-header {
            padding: 18px 24px;
            border-bottom: 1px solid var(--gray-lighter);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: var(--white);
            box-shadow: var(--shadow-sm);
            flex-shrink: 0; 
        }
        
        .header-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark);
        }
        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .user-profile-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
        }
        .settings-icon {
            font-size: 20px;
            color: var(--gray);
            cursor: pointer;
            transition: color 0.2s;
        }
        .settings-icon:hover {
            color: var(--primary);
        }
        
        .content-body {
            flex: 1; 
            overflow-y: auto; 
            padding: 24px;
        }
        
        .content-container { display: none; }
        .content-container.active { display: block; }
        
        .creation-panel { display: flex; gap: 24px; }
        .controls-column { width: 400px; display: flex; flex-direction: column; gap: 18px; flex-shrink: 0; } /* Slightly wider */
        .preview-column { flex: 1; display: flex; flex-direction: column; min-width: 0; }
        
        .control-group {
            background: var(--white);
            border-radius: var(--border-radius-lg);
            padding: 18px;
            border: 1px solid var(--gray-lighter);
            box-shadow: var(--shadow-sm);
            transition: box-shadow 0.3s ease;
        }
        .control-group:hover {
            box-shadow: var(--shadow-md);
        }
        
        .control-title {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: var(--gray-dark);
        }
        .control-title i.fas { margin-right: 8px; color: var(--primary); }
        .control-title i.fa-info-circle { color: var(--gray-light); cursor: help; margin-left: auto; margin-right: 0;}
        .control-title i.fa-info-circle:hover { color: var(--primary); }


        .tabs-container {
            display: flex;
            margin-bottom: 14px;
            border-bottom: 1px solid var(--gray-lighter);
            flex-wrap: nowrap; /* Prevent tabs from wrapping on small screens */
            overflow-x: auto; /* Allow horizontal scrolling for tabs if needed */
        }
        .tab-button {
            padding: 8px 12px;
            cursor: pointer;
            border: none;
            background-color: transparent;
            font-size: 13px;
            font-weight: 500;
            color: var(--gray);
            position: relative;
            transition: color 0.3s, border-bottom-color 0.3s;
            border-bottom: 2px solid transparent;
            white-space: nowrap; /* Prevent tab text from wrapping */
        }
        .tab-button.active {
            color: var(--primary);
            font-weight: 600;
            border-bottom-color: var(--primary);
        }
        .tab-button i.fas { margin-right: 6px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .genre-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(90px, 1fr)); gap: 10px; }
        .genre-card {
            background: var(--white);
            border-radius: var(--border-radius-md);
            padding: 12px;
            cursor: pointer;
            border: 1px solid var(--gray-lighter);
            transition: all 0.2s ease-in-out;
            text-align: center;
        }
        .genre-card:hover { border-color: var(--primary-light); transform: translateY(-2px); box-shadow: var(--shadow-sm); }
        .genre-card.active { border-color: var(--primary); background-color: rgba(134, 75, 255, 0.05); box-shadow: 0 0 0 2px rgba(134, 75, 255, 0.2); }
        .genre-icon { font-size: 22px; margin-bottom: 8px; color: var(--primary); }
        .genre-name { font-weight: 500; font-size: 12px; margin-bottom: 3px; color: var(--dark); }
        .genre-desc { font-size: 10px; color: var(--gray); line-height: 1.2; }
        
        .chip-grid { display: flex; flex-wrap: wrap; gap: 8px; }
        .chip {
            background: var(--gray-bg);
            border-radius: 16px;
            padding: 7px 14px;
            font-size: 12px;
            font-weight: 500;
            color: var(--gray-dark);
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            border: 1px solid var(--gray-lighter);
        }
        .chip:hover { background: var(--gray-lighter); border-color: var(--gray); }
        .chip.active { background: var(--primary); color: var(--white); border-color: var(--primary-dark); box-shadow: 0 1px 3px rgba(134, 75, 255, 0.3); }
        
        .slider-control { margin-bottom: 12px; }
        .slider-label { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 12px; color: var(--gray); }
        input[type="range"] {
            -webkit-appearance: none; width: 100%; height: 6px; background: var(--gray-lighter);
            border-radius: 3px; outline: none; opacity: 0.9; transition: opacity .2s;
        }
        input[type="range"]:hover { opacity: 1; }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 16px; height: 16px;
            background: var(--primary); cursor: pointer; border-radius: 50%;
            border: 2px solid var(--white); box-shadow: var(--shadow-sm);
        }
        input[type="range"]::-moz-range-thumb {
            width: 16px; height: 16px; background: var(--primary); cursor: pointer;
            border-radius: 50%; border: 2px solid var(--white); box-shadow: var(--shadow-sm);
        }
        
        .instrument-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(70px, 1fr)); gap: 8px; } /* Adjusted minmax for more items */
        .instrument-card {
            background: var(--white); border-radius: var(--border-radius-md); padding: 8px; /* Slightly less padding */
            border: 1px solid var(--gray-lighter); cursor: pointer; transition: all 0.2s ease-in-out;
            display: flex; flex-direction: column; align-items: center; text-align: center;
        }
        .instrument-card:hover { border-color: var(--primary-light); transform: translateY(-1px); }
        .instrument-card.active { border-color: var(--primary); background-color: rgba(134, 75, 255, 0.05); }
        .instrument-icon { font-size: 18px; margin-bottom: 5px; color: var(--primary); } /* Smaller icon */
        .instrument-name { font-size: 9px; font-weight: 500; color: var(--dark); line-height: 1.1; } /* Smaller name */

        .select-dropdown {
            width: 100%; padding: 9px 12px; border: 1px solid var(--gray-lighter);
            border-radius: var(--border-radius-sm); background-color: var(--white); font-size: 13px;
            color: var(--dark); appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23b3b3b3' width='18px' height='18px'%3E%3Cpath d='M7 10l5 5 5-5H7z'/%3E%3C/svg%3E");
            background-repeat: no-repeat; background-position: right 10px center; cursor: pointer;
        }
        .select-dropdown:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 2px rgba(134, 75, 255, 0.2); }
        
        .advanced-options, .ai-creative-tools-content, .sound-design-lab-content { margin-top: 12px; }
        .option-toggle {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 10px; padding: 6px 0;
        }
        .option-toggle span { font-size: 13px; color: var(--gray-dark); }
        .toggle-switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--gray-light); transition: .4s; border-radius: 20px;
        }
        .toggle-slider:before {
            position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px;
            background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        input:checked + .toggle-slider { background-color: var(--success); }
        input:checked + .toggle-slider:before { transform: translateX(20px); }

        .textarea-control {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            border: 1px solid var(--gray-lighter);
            border-radius: var(--border-radius-sm);
            font-size: 13px;
            line-height: 1.6;
            background-color: var(--white);
            color: var(--dark);
            resize: vertical;
            margin-bottom: 10px;
        }
        .textarea-control:focus {
            outline: none; border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(134, 75, 255, 0.15);
        }
        .simple-btn {
            background: var(--primary-light); color: white; border: none; padding: 8px 15px;
            border-radius: var(--border-radius-sm); font-weight: 500; font-size: 13px;
            cursor: pointer; transition: background-color 0.2s; display: inline-flex; align-items: center; gap: 6px;
        }
        .simple-btn:hover { background: var(--primary); }
        
        /* Preview Section */
        .preview-container {
            background: var(--white); border-radius: var(--border-radius-lg); padding: 20px;
            border: 1px solid var(--gray-lighter); box-shadow: var(--shadow-sm);
            display: flex; flex-direction: column;
            margin-bottom: 20px; 
        }
        .preview-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; }
        .preview-title { font-weight: 600; font-size: 16px; color: var(--dark); }
        .preview-actions { display: flex; gap: 8px; }
        .preview-btn {
            background: var(--gray-bg); border: 1px solid var(--gray-lighter); padding: 7px 14px;
            border-radius: var(--border-radius-sm); font-size: 12px; font-weight: 500;
            cursor: pointer; transition: all 0.2s; color: var(--gray-dark);
        }
        .preview-btn i { margin-right: 5px; }
        .preview-btn:hover { background-color: var(--gray-lighter); border-color: var(--gray); }
        .preview-btn.primary { background: var(--primary); color: white; border-color: var(--primary-dark); }
        .preview-btn.primary:hover { background: var(--primary-dark); }
        
        .waveform-container {
            height: 120px; background: var(--gray-bg); border-radius: var(--border-radius-md);
            margin-bottom: 18px; position: relative; overflow: hidden; border: 1px solid var(--gray-lighter);
        }
        .waveform { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; align-items: center; justify-content: space-around; padding: 0 8px; }
        .waveform-bar {
            background: var(--primary-light); width: 4px; margin: 0 1.5px; border-radius: 2px;
            animation: waveform-animation 1.2s infinite ease-in-out alternate;
            animation-play-state: paused; 
        }
        .waveform-container.animating .waveform-bar {
             animation-play-state: running;
        }
        @keyframes waveform-animation { 0% { height: 10%; opacity: 0.5; } 50% { height: 90%; opacity: 1; } 100% { height: 10%; opacity: 0.5; } }
        
        /* Lyrics Section */
        .lyrics-area { margin-top: 12px; }
        .lyrics-textarea-wrapper { position: relative; }
        .lyrics-textarea {
            width: 100%; min-height: 150px; padding: 12px; border: 1px solid var(--gray-lighter);
            border-radius: var(--border-radius-sm); font-size: 13px; line-height: 1.7;
            background-color: var(--white); color: var(--dark); resize: vertical;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .lyrics-textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 2px rgba(134, 75, 255, 0.15); }
        
        .lyrics-highlight-verse { background-color: rgba(255, 153, 0, 0.1); font-weight: bold; color: #cc7a00; }
        .lyrics-highlight-chorus { background-color: rgba(29, 185, 84, 0.1); font-weight: bold; color: #15733b; }
        .lyrics-highlight-bridge { background-color: rgba(41, 121, 255, 0.1); font-weight: bold; color: #1c54b3; }
        .lyrics-highlight-other { background-color: rgba(128, 128, 128, 0.1); font-style: italic; color: #505050; }

        .lyrics-tools {
            margin-top: 10px; padding: 10px; background-color: var(--gray-bg);
            border-radius: var(--border-radius-sm); border: 1px solid var(--gray-lighter);
        }
        .lyrics-tools .control-title { font-size: 13px; margin-bottom: 8px; }
        .lyric-tool-buttons { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 8px; }
        .lyric-tool-btn {
            background-color: var(--white); color: var(--gray-dark); border: 1px solid var(--gray-lighter);
            padding: 5px 10px; border-radius: var(--border-radius-sm); font-size: 11px;
            font-weight: 500; cursor: pointer; transition: all 0.2s;
        }
        .lyric-tool-btn i { margin-right: 4px; }
        .lyric-tool-btn:hover { background-color: var(--gray-lighter); border-color: var(--gray); }
        .lyric-tool-btn.primary { background-color: var(--info); color: var(--white); border-color: var(--info); }
        .lyric-tool-btn.primary:hover { background-color: #1e65cc; }

        .lyrics-meta { display: flex; justify-content: space-between; align-items: center; font-size: 11px; color: var(--gray); }
        .lyrics-meta > div { margin-right: 10px;}
        .lyrics-meta span { font-weight: 600; color: var(--primary); }
        .lyrics-tone-indicator { display: flex; align-items: center; }
        .lyrics-tone-indicator i { margin-right: 4px; font-size: 14px; }
        
        .lyrics-display-container { margin-top: 18px; margin-bottom: 20px; } 
        .lyrics-display {
            min-height: 100px; max-height: 180px; overflow-y: auto; padding: 12px; background: var(--gray-bg);
            border-radius: var(--border-radius-sm); font-size: 13px; line-height: 1.7;
            white-space: pre-wrap; border: 1px solid var(--gray-lighter); color: var(--dark);
        }

        /* Track Workspace & Effects */
        .track-workspace-container {
            background: var(--white);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            border: 1px solid var(--gray-lighter);
            box-shadow: var(--shadow-sm);
            margin-top: 20px; 
        }
        .effects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        .effect-control-group {
            background-color: var(--gray-bg);
            padding: 15px;
            border-radius: var(--border-radius-md);
            border: 1px solid var(--gray-lighter);
        }
        .effect-control-group .control-title {
            font-size: 14px;
            margin-bottom: 10px;
        }
        .effect-control-group .slider-control { margin-bottom: 8px; }
        .effect-control-group .select-dropdown { margin-top: 5px; font-size: 12px; padding: 6px 8px;}

        .eq-bands { display: flex; justify-content: space-around; gap: 10px; }
        .eq-band { flex: 1; text-align: center; }
        .eq-band input[type="range"] {
            -webkit-appearance: slider-vertical; 
            appearance: slider-vertical;
            width: 20px; 
            height: 80px; 
            margin: 0 auto;
        }
         .eq-band label { font-size: 11px; color: var(--gray); display: block; margin-top: 5px;}

        .ai-assist-tools { margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--gray-lighter); }
        .ai-tool-row { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px; }
        .ai-tool-btn {
            background-color: var(--primary-light); color: var(--white); border:none;
            padding: 8px 12px; border-radius: var(--border-radius-sm); font-size: 12px;
            font-weight: 500; cursor: pointer; transition: background-color 0.2s;
            display: inline-flex; align-items: center; gap: 6px;
        }
        .ai-tool-btn:hover { background-color: var(--primary); }
        .ai-tool-btn i { font-size: 14px; }

        /* MIDI & Arrangement Editor Placeholder */
        .midi-arrangement-editor {
            margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--gray-lighter);
        }
        .piano-roll-placeholder {
            height: 150px;
            background-color: var(--gray-dark);
            border-radius: var(--border-radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray);
            font-size: 14px;
            text-align: center;
            border: 2px dashed var(--gray);
            margin-top: 10px;
        }


        /* Generation Options */
        .generation-options { display: flex; gap: 12px; margin-top: 20px; }
        .generate-btn {
            background: var(--gradient-primary); color: white; border: none; padding: 12px 24px;
            border-radius: var(--border-radius-md); font-weight: 600; font-size: 14px;
            cursor: pointer; transition: all 0.25s ease-in-out; flex: 1;
            display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: var(--shadow-sm);
        }
        .generate-btn:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); filter: brightness(1.1); }
        .generate-btn.secondary { background: var(--gray-bg); color: var(--dark); border: 1px solid var(--gray-lighter); }
        .generate-btn.secondary:hover { background: var(--gray-lighter); border-color: var(--gray); box-shadow: var(--shadow-sm); filter: none;}
        
        /* Library Specific Styles */
        .library-actions { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .library-filter-sort { display: flex; gap: 10px; flex-wrap: wrap; }
        .library-filter-sort .select-dropdown, .library-filter-sort .search-bar-small {
            padding: 6px 10px; font-size: 12px; max-width: 150px;
        }
        .library-batch-actions button { margin-left: 10px; }

        .track-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
        .track-card {
            background: var(--white); border-radius: var(--border-radius-md); overflow: hidden;
            border: 1px solid var(--gray-lighter); transition: all 0.2s ease-in-out;
            cursor: pointer; box-shadow: var(--shadow-sm); display: flex; flex-direction: column;
        }
        .track-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); }
        .track-cover-large {
            height: 140px; background-color: var(--gray-bg); display: flex; align-items: center;
            justify-content: center; color: var(--gray-light); position: relative;
        }
        .track-cover-large img { width: 100%; height: 100%; object-fit: cover; }
        .track-cover-large .fa-music, .track-cover-large .fa-compact-disc, .track-cover-large .fa-guitar-electric { font-size: 36px; }
        .track-actions-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.4);
            display: flex; align-items: center; justify-content: center; gap: 10px;
            opacity: 0; transition: opacity 0.2s ease-in-out;
        }
        .track-card:hover .track-actions-overlay { opacity: 1; }
        .track-action-btn {
            background: rgba(255,255,255,0.85); color: var(--primary); border: none;
            width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; cursor: pointer; font-size: 16px;
            transition: transform 0.2s, background-color 0.2s; box-shadow: var(--shadow-sm);
        }
        .track-action-btn:hover { transform: scale(1.1); background-color: var(--white); }
        .track-info-large { padding: 12px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .track-title { font-weight: 600; font-size: 14px; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--dark); }
        .track-meta { font-size: 11px; color: var(--gray); display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .track-stats { font-size: 10px; color: var(--gray-light); display: flex; gap: 10px; }
        .track-stats i { margin-right: 3px; }
        .track-tags { margin-top: 5px; }
        .track-tag { background-color: var(--gray-bg); color: var(--gray-dark); font-size: 9px; padding: 2px 5px; border-radius: var(--border-radius-sm); display: inline-block; margin-right: 4px; margin-bottom: 4px;}
        .pagination { display: flex; justify-content: center; align-items: center; margin-top: 20px; }
        .pagination button { background: var(--white); border: 1px solid var(--gray-lighter); padding: 5px 10px; margin: 0 3px; cursor: pointer; border-radius: var(--border-radius-sm); font-size: 12px;}
        .pagination button:hover, .pagination button.active { background: var(--primary); color: var(--white); border-color: var(--primary); }
        .pagination button:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Stem Mixer Styles */
        .stem-mixer-upload { text-align: center; padding: 20px; border: 2px dashed var(--gray-lighter); border-radius: var(--border-radius-md); margin-bottom: 20px; background-color: var(--white); }
        .stem-mixer-upload i { font-size: 30px; color: var(--primary); margin-bottom: 10px; }
        .stem-track { display: flex; align-items: center; padding: 10px; background-color: var(--white); border-radius: var(--border-radius-md); margin-bottom: 10px; box-shadow: var(--shadow-sm); }
        .stem-icon { font-size: 20px; color: var(--primary); margin-right: 15px; width: 30px; text-align: center; }
        .stem-name { font-weight: 500; width: 100px; font-size: 13px; }
        .stem-controls { flex: 1; display: flex; align-items: center; gap: 15px; }
        .stem-controls .slider-control { flex: 1; margin-bottom: 0; }
        .stem-controls .slider-label span:first-child { display: none; } /* Hide "Volume" text */
        .stem-actions button { margin-left: 8px; font-size: 14px; padding: 5px 8px; }

        /* Home Feed Styles */
        .feed-section { margin-bottom: 30px; }
        .feed-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .feed-card { background: var(--white); border-radius: var(--border-radius-md); box-shadow: var(--shadow-sm); overflow: hidden; }
        .feed-card-image { height: 120px; background-color: var(--gray-bg); display: flex; align-items: center; justify-content: center; }
        .feed-card-image i { font-size: 30px; color: var(--gray); }
        .feed-card-content { padding: 15px; }
        .feed-card-title { font-weight: 600; font-size: 15px; margin-bottom: 5px; }
        .feed-card-desc { font-size: 12px; color: var(--gray); margin-bottom: 10px; }
        .feed-card-action { font-size: 12px; color: var(--primary); font-weight: 500; text-decoration: none; }

        /* Explore Genres Styles */
        .genre-explore-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .genre-explore-card { background-color: var(--white); border-radius: var(--border-radius-md); padding: 20px; text-align: center; box-shadow: var(--shadow-sm); cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .genre-explore-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-md); }
        .genre-explore-card i { font-size: 30px; color: var(--primary); margin-bottom: 10px; }
        .genre-explore-card h3 { font-size: 16px; font-weight: 600; margin-bottom: 5px; }
        .ai-genre-blender { margin-top: 30px; padding: 20px; background-color: var(--white); border-radius: var(--border-radius-lg); box-shadow: var(--shadow-sm); }
        .genre-blend-selects { display: flex; gap: 15px; margin-bottom: 15px; }
        .genre-blend-selects .select-dropdown { flex: 1; }

        /* Global Search Styles */
        .global-search-filters { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; padding: 15px; background-color: var(--white); border-radius: var(--border-radius-md); box-shadow: var(--shadow-sm); }
        .global-search-filters input, .global-search-filters .select-dropdown { flex-grow: 1; min-width: 150px; font-size: 13px; padding: 8px 10px; }
        .search-results-tabs .tabs-container { border-bottom: none; } /* Remove double border */
        .search-results-tabs .tab-button { padding: 10px 15px; font-size: 14px; }
        .search-result-item { padding: 10px; border-bottom: 1px solid var(--gray-lighter); }
        .search-result-item:last-child { border-bottom: none; }

        /* Account Page Styles */
        .account-page-grid { display: grid; grid-template-columns: 1fr; gap: 20px; } /* Single column for now */
        .profile-form .form-group, .settings-form .form-group { margin-bottom: 15px; }
        .profile-form label, .settings-form label { display: block; font-size: 13px; font-weight: 500; margin-bottom: 5px; }
        .profile-form input[type="text"], .profile-form input[type="email"], .profile-form textarea,
        .settings-form .select-dropdown { width: 100%; padding: 8px 10px; border: 1px solid var(--gray-lighter); border-radius: var(--border-radius-sm); font-size: 13px; }
        .profile-form textarea { min-height: 80px; resize: vertical; }
        .notification-item { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid var(--gray-lighter); font-size: 13px; }
        .notification-item i { margin-right: 10px; color: var(--primary); }
        .notification-item:last-child { border-bottom: none; }
        .subscription-plans { display: flex; gap: 20px; margin-top: 20px; }
        .plan-card { flex: 1; background-color: var(--white); border: 1px solid var(--gray-lighter); border-radius: var(--border-radius-md); padding: 20px; text-align: center; box-shadow: var(--shadow-sm); }
        .plan-card h3 { font-size: 18px; color: var(--primary); margin-bottom: 10px; }
        .plan-card .price { font-size: 24px; font-weight: 600; margin-bottom: 15px; }
        .plan-card ul { list-style: none; padding: 0; margin-bottom: 20px; font-size: 13px; color: var(--gray-dark); }
        .plan-card ul li { margin-bottom: 8px; }
        .plan-card ul li i { color: var(--success); margin-right: 5px; }
        
        /* Responsive Adjustments */
        .menu-toggle-btn { display: none; } 

        @media (max-width: 1200px) {
            .creation-panel { flex-direction: column; }
            .controls-column { width: 100%; margin-bottom: 20px; }
            .preview-column { width: 100%; }
            .effects-grid { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));}
        }
        @media (max-width: 992px) { /* Tablet */
            .sidebar { width: 260px; } /* Keep sidebar width consistent for now */
            .content-header { padding: 15px 20px; }
            .header-title { font-size: 18px;}
            .content-body { padding: 20px; }
            .controls-column { width: 100%; } /* Full width for controls on tablet */
        }

        @media (max-width: 768px) { /* Mobile */
            .sidebar {
                position: fixed; left: -280px; z-index: 1001; /* Ensure sidebar is above toggle */
                transition: left 0.3s ease-in-out; height: 100%;
                box-shadow: var(--shadow-lg); width: 280px; 
            }
            .sidebar.open { left: 0; }
            .main-content { margin-left: 0; }
            
            .content-header { padding: 12px 15px; }
            .header-title { font-size: 18px; }
            .header-actions .preview-btn { display: none; } 
            .content-body { padding: 15px; }
            .menu-toggle-btn {
                display: block; position: fixed; top: 12px; left: 15px; z-index: 1002; /* Above sidebar */
                background: var(--primary); color: white; border: none; padding: 8px;
                border-radius: 50%; font-size: 18px; cursor: pointer; box-shadow: var(--shadow-md);
                width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
            }
            .effects-grid { grid-template-columns: 1fr;} 
            .eq-bands { flex-direction: column; align-items: stretch;}
            .eq-band input[type="range"] { width: 100%; height: 20px; -webkit-appearance: none; appearance: none;}
            .creation-panel { flex-direction: column; } /* Stack columns on mobile */
            .controls-column { width: 100%; }
            .instrument-list { grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));} /* Smaller instrument cards on mobile */
            .tabs-container { padding-bottom: 5px; } /* Ensure scrollbar doesn't overlap border */
            .subscription-plans { flex-direction: column; }
        }
    </style>
</head>
<body>
    <button class="menu-toggle-btn" id="menuToggle"><i class="fas fa-bars"></i></button>

    <div class="app-container">
        <div class="sidebar" id="sidebar">
            <div class="logo-container">
                <div class="logo"><i class="fas fa-brain-circuit logo-icon"></i>KDZ Ai Music Creator</div>
            </div>
            <div class="nav-container">
                <div class="nav-section">
                    <div class="section-title">Core Tools</div>
                    <div class="nav-item active" data-content="create"><i class="fas fa-magic-wand-sparkles nav-icon"></i> Create New</div>
                    <div class="nav-item" data-content="library"><i class="fas fa-album-collection nav-icon"></i> My Library <span class="badge" id="libraryCountBadge">0</span></div>
                    <div class="nav-item" data-content="stem-mixer"><i class="fas fa-sliders nav-icon"></i> Stem Mixer</div>
                </div>
                <div class="divider"></div>
                <div class="nav-section">
                    <div class="section-title">Discover & Explore</div>
                    <div class="nav-item" data-content="home-feed"><i class="fas fa-house-signal nav-icon"></i> Home Feed</div>
                    <div class="nav-item" data-content="explore-genres"><i class="fas fa-guitar-electric nav-icon"></i> Explore Genres</div>
                    <div class="nav-item" data-content="global-search"><i class="fas fa-magnifying-glass-location nav-icon"></i> Global Search</div>
                </div>
                <div class="divider"></div>
                <div class="nav-section">
                    <div class="section-title">Advanced Track Tools</div>
                    <div class="nav-item" data-content="extend-track"><i class="fas fa-arrows-maximize nav-icon"></i> Extend Track</div>
                    <div class="nav-item" data-content="publish-share"><i class="fas fa-share-alt nav-icon"></i> Publish & Share</div>
                </div>
                <div class="divider"></div>
                <div class="nav-section">
                    <div class="section-title">Account & Support</div>
                    <div class="nav-item" data-content="notifications"><i class="fas fa-bells nav-icon"></i> Notifications <span class="badge">12</span></div>
                    <div class="nav-item" data-content="profile"><i class="fas fa-user-circle nav-icon"></i> My Profile</div>
                    <div class="nav-item" data-content="settings"><i class="fas fa-user-gear nav-icon"></i> App Settings</div>
                    <div class="nav-item" data-content="upgrade-plan"><i class="fas fa-gem nav-icon"></i> Upgrade Plan</div>
                    <div class="nav-item" data-content="help-center"><i class="fas fa-question-circle nav-icon"></i> Help Center</div>
                </div>
                <div class="section-note">âœ¨ v5: New AI tools & expanded library features!</div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="content-header">
                <div class="header-title" id="mainHeaderTitle">Create New Track</div>
                 <div class="header-actions">
                    <button class="preview-btn primary" id="uploadAudioHeaderBtn" style="padding: 8px 16px;"><i class="fas fa-cloud-arrow-up"></i> Upload Audio</button>
                    <i class="fas fa-cog settings-icon" title="App Settings" id="appSettingsIcon"></i>
                    <div class="user-profile-icon" title="User Account" id="userProfileHeaderIcon">S</div>
                </div>
            </div>
            
            <div class="content-body">
                <div class="content-container active" id="create-content">
                    <div class="creation-panel">
                        <div class="controls-column">
                            <div class="control-group">
                                <div class="control-title"><i class="fas fa-music"></i><span>Music Genre</span><i class="fas fa-info-circle" title="Select the primary genre."></i></div>
                                <div class="genre-grid">
                                    <div class="genre-card active" data-genre="Electronic"><div class="genre-icon"><i class="fas fa-wave-sine"></i></div><div class="genre-name">Electronic</div><div class="genre-desc">Synths & Beats</div></div>
                                    <div class="genre-card" data-genre="Pop"><div class="genre-icon"><i class="fas fa-microphone-stand"></i></div><div class="genre-name">Pop</div><div class="genre-desc">Catchy</div></div>
                                    <div class="genre-card" data-genre="Rock"><div class="genre-icon"><i class="fas fa-guitar"></i></div><div class="genre-name">Rock</div><div class="genre-desc">Energy</div></div>
                                    <div class="genre-card" data-genre="Hip Hop"><div class="genre-icon"><i class="fas fa-boombox"></i></div><div class="genre-name">Hip Hop</div><div class="genre-desc">Rhymes</div></div>
                                    <div class="genre-card" data-genre="Ambient"><div class="genre-icon"><i class="fas fa-cloud-moon"></i></div><div class="genre-name">Ambient</div><div class="genre-desc">Atmospheric</div></div>
                                    <div class="genre-card" data-genre="Classical"><div class="genre-icon"><i class="fas fa-violin"></i></div><div class="genre-name">Classical</div><div class="genre-desc">Orchestral</div></div>
                                </div>
                            </div>
                            
                            <div class="control-group">
                                <div class="control-title"><i class="fas fa-face-grin-beam"></i><span>Mood / Vibe</span><i class="fas fa-info-circle" title="Set the overall mood."></i></div>
                                <div class="chip-grid" id="moodChips">
                                    <div class="chip active">Upbeat</div><div class="chip">Chill</div><div class="chip">Energetic</div>
                                    <div class="chip">Melancholic</div><div class="chip">Dark</div><div class="chip">Epic</div>
                                    <div class="chip">Peaceful</div><div class="chip">Mysterious</div>
                                </div>
                            </div>

                            <div class="control-group">
                                <div class="control-title"><i class="fas fa-bolt"></i><span>Energy Level</span><span id="energyValue">Medium</span></div>
                                <div class="slider-control">
                                     <input type="range" min="1" max="5" value="3" class="range-slider" id="energySlider">
                                    <div class="slider-label"><span>Low</span><span>High</span></div>
                                </div>
                            </div>
                            
                            <div class="control-group">
                                <div class="control-title"><i class="fas fa-diagram-project"></i><span>Song Structure</span><i class="fas fa-info-circle" title="Suggest a common song structure."></i></div>
                                <div class="chip-grid" id="structureChips">
                                    <div class="chip active">Verse-Chorus</div><div class="chip">AABA</div>
                                    <div class="chip">Intro-V-C-Outro</div><div class="chip">Freestyle</div>
                                    <div class="chip">Cinematic Arc</div>
                                </div>
                            </div>

                            <div style="display: flex; gap: 15px;">
                                <div class="control-group" style="flex:1;">
                                    <div class="control-title" style="font-size:13px;"><i class="fas fa-key"></i><span>Key</span></div>
                                    <select class="select-dropdown" id="keySignature" style="font-size:12px; padding: 8px 10px;">
                                        <option value="Cmaj">C Maj / A Min</option><option value="Gmaj">G Maj / E Min</option>
                                        <option value="Dmaj">D Maj / B Min</option><option value="Fmaj">F Maj / D Min</option>
                                    </select>
                                </div>
                                <div class="control-group" style="flex:1;">
                                    <div class="control-title" style="font-size:13px;"><i class="fas fa-gauge-high"></i><span>BPM</span><span id="bpmValue" style="font-size:13px;">120</span></div>
                                    <div class="slider-control" style="margin-bottom:0;">
                                        <input type="range" min="60" max="200" value="120" class="range-slider" id="tempoSlider">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="control-group">
                                <div class="control-title"><i class="fas fa-piano-keyboard"></i><span>Instruments</span><i class="fas fa-plus-circle" title="Add or remove instruments"></i></div>
                                <div class="instrument-list">
                                    <div class="instrument-card active"><div class="instrument-icon"><i class="fas fa-guitar"></i></div><div class="instrument-name">Guitar</div></div>
                                    <div class="instrument-card active"><div class="instrument-icon"><i class="fas fa-drum"></i></div><div class="instrument-name">Drums</div></div>
                                    <div class="instrument-card"><div class="instrument-icon"><i class="fas fa-piano"></i></div><div class="instrument-name">Piano</div></div>
                                    <div class="instrument-card"><div class="instrument-icon"><i class="fas fa-rectangle-pro"></i></div><div class="instrument-name">Bass</div></div>
                                    <div class="instrument-card"><div class="instrument-icon"><i class="fas fa-trumpet"></i></div><div class="instrument-name">Brass</div></div>
                                    <div class="instrument-card"><div class="instrument-icon"><i class="fas fa-violin"></i></div><div class="instrument-name">Strings Ens.</div></div>
                                    <div class="instrument-card"><div class="instrument-icon"><i class="fas fa-waveform-lines"></i></div><div class="instrument-name">Synth Lead</div></div>
                                    <div class="instrument-card"><div class="instrument-icon"><i class="fas fa-wave-pulse"></i></div><div class="instrument-name">Synth Pad</div></div>
                                    <div class="instrument-card"><div class="instrument-icon"><i class="fas fa-users-viewfinder"></i></div><div class="instrument-name">Choir Aahs</div></div>
                                    <div class="instrument-card"><div class="instrument-icon"><i class="fas fa-bongos"></i></div><div class="instrument-name">Ethnic Perc.</div></div>
                                    <div class="instrument-card"><div class="instrument-icon"><i class="fas fa-flute"></i></div><div class="instrument-name">Woodwinds</div></div>
                                    <div class="instrument-card"><div class="instrument-icon"><i class="fas fa-alien-8bit"></i></div><div class="instrument-name">Sound FX</div></div>
                                </div>
                            </div>

                            <div class="control-group">
                                <div class="tabs-container">
                                    <button class="tab-button active" data-tab="lyricsTab"><i class="fas fa-file-lines"></i> Lyrics</button>
                                    <button class="tab-button" data-tab="vocalsTab"><i class="fas fa-microphone-lines"></i> Vocals</button>
                                    <button class="tab-button" data-tab="aiToolsTab"><i class="fas fa-brain-circuit"></i> AI Tools</button>
                                    <button class="tab-button" data-tab="soundDesignTab"><i class="fas fa-atom-simple"></i> Sound Design</button>
                                    <button class="tab-button" data-tab="advancedTab"><i class="fas fa-sliders-up"></i> Advanced</button>
                                </div>

                                <div id="lyricsTab" class="tab-content active">
                                    <div class="lyrics-area">
                                        <div class="lyrics-textarea-wrapper">
                                            <textarea id="lyricsTextarea" class="lyrics-textarea" placeholder="Type or paste lyrics... e.g., [Verse 1] My song begins..."></textarea>
                                        </div>
                                        <div class="lyrics-tools">
                                            <div class="control-title" style="font-size:13px; margin-bottom:8px;">Lyric Tools</div>
                                            <div class="lyric-tool-buttons">
                                                <button class="lyric-tool-btn" id="analyzeStructureBtn"><i class="fas fa-magnifying-glass-plus"></i> Analyze</button>
                                                <button class="lyric-tool-btn primary" id="suggestLineBtn"><i class="fas fa-lightbulb-on"></i> Suggest</button>
                                                <button class="lyric-tool-btn" id="saveSnippetBtn"><i class="fas fa-floppy-disk"></i> Save</button>
                                                <button class="lyric-tool-btn" id="loadSnippetBtn"><i class="fas fa-folder-arrow-up"></i> Load</button>
                                            </div>
                                            <div class="lyrics-meta">
                                                <div>Words: <span id="wordCountDisplay">0</span></div>
                                                <div>Chars: <span id="charCountDisplay">0</span></div>
                                                <div>Sylls: <span id="syllableCountDisplay">0</span></div>
                                                <div class="lyrics-tone-indicator" id="lyricToneDisplay"><i class="fas fa-face-meh"></i><span>Neutral</span></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="vocalsTab" class="tab-content">
                                    <div class="control-group" style="padding:0; border:none; box-shadow:none;">
                                        <div class="control-title" style="margin-bottom:10px;"><i class="fas fa-microphone-stand"></i><span>Vocal Style</span><i class="fas fa-info-circle" title="Select AI vocal style."></i></div>
                                        <div class="chip-grid" id="vocalStyleChips">
                                            <div class="chip active" data-vocal="sung-male">Sung (M)</div><div class="chip" data-vocal="sung-female">Sung (F)</div>
                                            <div class="chip" data-vocal="rapped-male">Rap (M)</div><div class="chip" data-vocal="rapped-female">Rap (F)</div>
                                            <div class="chip" data-vocal="backing">Backing</div><div class="chip" data-vocal="spoken">Spoken</div>
                                            <div class="chip" data-vocal="ethereal">Ethereal</div><div class="chip" data-vocal="robotic">Robotic</div>
                                        </div>
                                        <div class="option-toggle" style="margin-top: 15px;"><span>Instrumental (No Vocals)</span><label class="toggle-switch"><input type="checkbox" id="instrumentalOnlyToggle"><span class="toggle-slider"></span></label></div>
                                    </div>
                                </div>
                                
                                <div id="aiToolsTab" class="tab-content">
                                    <div class="ai-creative-tools-content">
                                        <div class="control-title" style="margin-bottom:10px;"><i class="fas fa-wand-magic-sparkles"></i><span>AI Creative Assists</span></div>
                                        <button class="simple-btn" id="aiChordProgressionBtn" style="margin-bottom:10px; width:100%; justify-content: center;"><i class="fas fa-diagram-sankey"></i> Generate Chord Progression</button>
                                        <div class="option-toggle"><span>AI Groove Assist</span><label class="toggle-switch"><input type="checkbox" id="aiGrooveAssistToggle"><span class="toggle-slider"></span></label></div>
                                        
                                        <div class="control-title" style="font-size:13px; margin-top:15px; margin-bottom:8px;"><i class="fas fa-feather-alt"></i><span>Story to Song (Experimental)</span></div>
                                        <textarea id="storyToSongTextarea" class="textarea-control" rows="3" placeholder="Enter a short story or theme..."></textarea>
                                        <button class="simple-btn" id="aiStoryToSongBtn" style="width:100%; justify-content: center;"><i class="fas fa-book-music"></i> Create from Story</button>
                                    </div>
                                </div>
                                
                                <div id="soundDesignTab" class="tab-content">
                                    <div class="sound-design-lab-content">
                                        <div class="control-title"><i class="fas fa-atom"></i><span>Sound Design Lab (Synth)</span></div>
                                        <div class="control-group" style="padding:10px; margin-bottom:10px;">
                                            <div class="control-title" style="font-size:13px; margin-bottom:8px;">Oscillator 1</div>
                                            <select class="select-dropdown" id="osc1Waveform" style="margin-bottom:8px;"><option>Sine</option><option>Square</option><option>Sawtooth</option><option>Triangle</option><option>Noise</option></select>
                                            <label class="slider-label" style="font-size:11px;"><span>Detune</span><span id="osc1DetuneValue">0</span></label>
                                            <input type="range" min="-50" max="50" value="0" id="osc1DetuneSlider">
                                        </div>
                                        <div class="control-group" style="padding:10px; margin-bottom:10px;">
                                            <div class="control-title" style="font-size:13px; margin-bottom:8px;">Filter</div>
                                            <select class="select-dropdown" id="filterType" style="margin-bottom:8px;"><option>Low Pass</option><option>High Pass</option><option>Band Pass</option></select>
                                            <label class="slider-label" style="font-size:11px;"><span>Cutoff</span><span id="filterCutoffValue">1000</span>Hz</label>
                                            <input type="range" min="20" max="20000" value="1000" id="filterCutoffSlider">
                                            <label class="slider-label" style="font-size:11px;"><span>Resonance</span><span id="filterResonanceValue">0.5</span></label>
                                            <input type="range" min="0" max="1" value="0.5" step="0.01" id="filterResonanceSlider">
                                        </div>
                                         <button class="simple-btn" id="applySynthSoundBtn" style="width:100%; justify-content: center;"><i class="fas fa-check-circle"></i> Apply Synth Sound</button>
                                    </div>
                                </div>

                                <div id="advancedTab" class="tab-content">
                                    <div class="advanced-options">
                                        <div class="option-toggle"><span>Auto-Tune Vocals (Subtle)</span><label class="toggle-switch"><input type="checkbox" checked><span class="toggle-slider"></span></label></div>
                                        <div class="option-toggle"><span>Humanize Timing</span><label class="toggle-switch"><input type="checkbox"><span class="toggle-slider"></span></label></div>
                                        <div class="option-toggle"><span>AI Performance Style</span><label class="toggle-switch"><input type="checkbox" checked><span class="toggle-slider"></span></label></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="generation-options">
                                <button class="generate-btn secondary"><i class="fas fa-bolt-lightning"></i> Quick Generate</button>
                                <button class="generate-btn"><i class="fas fa-stars"></i> Studio Generate</button>
                            </div>
                        </div>
                        
                        <div class="preview-column">
                            <div class="preview-container">
                                <div class="preview-header">
                                    <div class="preview-title">Track Preview</div>
                                    <div class="preview-actions">
                                        <button class="preview-btn" id="remixTrackBtn"><i class="fas fa-dice-d6"></i> Remix</button>
                                        <button class="preview-btn primary" id="saveTrackBtn"><i class="fas fa-save"></i> Save</button>
                                    </div>
                                </div>
                                <div class="waveform-container" id="previewWaveform"><div class="waveform"></div></div>
                                <div class="lyrics-display-container">
                                    <div class="control-title" style="font-size:14px;"><i class="fas fa-file-music"></i><span>Generated Lyrics Preview</span></div>
                                    <div class="lyrics-display" id="generatedLyricsDisplay">
                                        [Verse 1]
                                        The stage is set, the AI waits,
                                        For your ideas, to open gates.
                                        [Chorus]
                                        New sounds emerge, a digital art,
                                        Crafted with code, right from the start!
                                    </div>
                                </div>
                            </div>

                            <div class="track-workspace-container">
                                <div class="control-title" style="font-size: 16px; margin-bottom:15px;">
                                    <i class="fas fa-sliders-h"></i><span>Track Workspace & Effects</span>
                                     <div class="preview-actions"> <button class="preview-btn" id="trackVersionsBtn" title="Version History"><i class="fas fa-history"></i></button>
                                        <button class="preview-btn" id="collaborateTrackBtn" title="Collaborate"><i class="fas fa-users"></i></button>
                                    </div>
                                </div>
                                <div class="effects-grid">
                                    <div class="effect-control-group">
                                        <div class="control-title"><i class="fas fa-water-lower"></i>Reverb</div>
                                        <div class="slider-control">
                                            <label class="slider-label" style="font-size:11px;"><span>Amount</span><span id="reverbAmountValue">50</span></label>
                                            <input type="range" min="0" max="100" value="50" id="reverbAmountSlider">
                                        </div>
                                        <select class="select-dropdown" id="reverbType">
                                            <option value="hall">Hall</option><option value="room">Room</option>
                                            <option value="plate">Plate</option><option value="spring">Spring</option>
                                        </select>
                                    </div>
                                    <div class="effect-control-group">
                                        <div class="control-title"><i class="fas fa-repeat-alt"></i>Delay</div>
                                        <div class="slider-control">
                                            <label class="slider-label" style="font-size:11px;"><span>Time (ms)</span><span id="delayTimeValue">300</span></label>
                                            <input type="range" min="50" max="1000" value="300" step="10" id="delayTimeSlider">
                                        </div>
                                        <div class="slider-control">
                                            <label class="slider-label" style="font-size:11px;"><span>Feedback</span><span id="delayFeedbackValue">40</span></label>
                                            <input type="range" min="0" max="90" value="40" id="delayFeedbackSlider">
                                        </div>
                                        <div class="slider-control">
                                            <label class="slider-label" style="font-size:11px;"><span>Mix</span><span id="delayMixValue">30</span></label>
                                            <input type="range" min="0" max="100" value="30" id="delayMixSlider">
                                        </div>
                                    </div>
                                    <div class="effect-control-group">
                                        <div class="control-title"><i class="fas fa-volume-scream"></i>Distortion</div>
                                        <div class="slider-control">
                                            <label class="slider-label" style="font-size:11px;"><span>Drive</span><span id="distortionDriveValue">25</span></label>
                                            <input type="range" min="0" max="100" value="25" id="distortionDriveSlider">
                                        </div>
                                        <select class="select-dropdown" id="distortionType">
                                            <option value="overdrive">Overdrive</option><option value="fuzz">Fuzz</option>
                                            <option value="bitcrush">Bitcrush</option><option value="saturate">Saturation</option>
                                        </select>
                                    </div>
                                    <div class="effect-control-group">
                                        <div class="control-title"><i class="fas fa-sliders"></i>Equalizer</div>
                                        <div class="eq-bands">
                                            <div class="eq-band">
                                                <input type="range" min="-12" max="12" value="0" id="eqLow"><label>Low</label>
                                            </div>
                                            <div class="eq-band">
                                                <input type="range" min="-12" max="12" value="0" id="eqMid"><label>Mid</label>
                                            </div>
                                            <div class="eq-band">
                                                <input type="range" min="-12" max="12" value="0" id="eqHigh"><label>High</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="ai-assist-tools">
                                    <div class="control-title" style="font-size: 14px; margin-bottom:10px;"><i class="fas fa-microchip"></i><span>AI Assist & Polish</span></div>
                                    <div class="ai-tool-row">
                                        <button class="ai-tool-btn" id="aiHarmonyBtn"><i class="fas fa-people-arrows"></i> Harmony Suggestions</button>
                                        <button class="ai-tool-btn" id="aiMelodyRefineBtn"><i class="fas fa-feather-pointed"></i> Melody Refiner</button>
                                    </div>
                                    <div class="option-toggle">
                                        <span>AI Mastering Preview</span>
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="aiMasteringToggle"><span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                    <div class="slider-control">
                                        <label class="slider-label" style="font-size:12px;"><span>AI Variation Exploration</span><span id="aiVariationValue">Low</span></label>
                                        <input type="range" min="1" max="5" value="2" id="aiVariationSlider">
                                    </div>
                                </div>
                                
                                <div class="midi-arrangement-editor">
                                     <div class="control-title" style="font-size: 14px; margin-bottom:10px;"><i class="fas fa-piano-keyboard"></i><span>MIDI & Arrangement Editor</span></div>
                                     <div class="piano-roll-placeholder">
                                         Piano Roll / Sequencer Area (Conceptual UI)
                                         <br><small>Edit notes, timing, and arrangement.</small>
                                     </div>
                                     <div style="margin-top:10px; display:flex; gap:10px;">
                                        <button class="simple-btn" id="importMidiBtn"><i class="fas fa-file-import"></i> Import MIDI</button>
                                        <button class="simple-btn" id="exportMidiBtn"><i class="fas fa-file-export"></i> Export MIDI</button>
                                     </div>
                                </div>

                            </div> 
                        </div> 
                    </div> 
                </div> 
                
                <div class="content-container" id="library-content">
                    <div class="library-actions">
                        <div class="library-filter-sort">
                            <input type="text" class="search-bar-small" id="librarySearchInput" placeholder="Search library...">
                            <select class="select-dropdown" id="librarySortBy">
                                <option value="date_desc">Date (Newest)</option>
                                <option value="date_asc">Date (Oldest)</option>
                                <option value="title_asc">Title (A-Z)</option>
                                <option value="plays_desc">Most Plays</option>
                            </select>
                            <select class="select-dropdown" id="libraryFilterGenre">
                                <option value="">All Genres</option>
                                </select>
                             <input type="text" class="search-bar-small" id="libraryTagInput" placeholder="Filter by tag...">
                        </div>
                        <div class="library-batch-actions">
                            <button class="preview-btn" id="libraryAddToPlaylistBtn"><i class="fas fa-plus-square"></i> Add to Playlist</button>
                            <button class="preview-btn" id="libraryExportSelectedBtn"><i class="fas fa-file-export"></i> Export</button>
                            <button class="preview-btn danger" id="libraryDeleteSelectedBtn"><i class="fas fa-trash-alt"></i> Delete</button>
                        </div>
                    </div>
                    <div class="track-grid" id="libraryTrackGrid">
                        </div>
                    <div class="pagination" id="libraryPagination">
                        <button id="prevPageBtn" disabled><i class="fas fa-chevron-left"></i> Prev</button>
                        <span id="pageInfo">Page 1 of 1</span>
                        <button id="nextPageBtn" disabled>Next <i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>

                <div class="content-container" id="stem-mixer-content">
                    <div class="control-title" style="font-size:18px; margin-bottom:20px;"><i class="fas fa-cogs"></i> AI Stem Mixer</div>
                    <div class="stem-mixer-upload" id="stemMixerUploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Drag & Drop your audio file here or</p>
                        <button class="simple-btn" style="margin-top:10px;" id="stemMixerBrowseBtn"><i class="fas fa-folder-open"></i> Browse File</button>
                        <input type="file" id="stemMixerFileInput" accept="audio/*" style="display:none;">
                    </div>
                    <div id="stemTracksContainer" style="display:none;">
                        <div class="control-title" style="font-size:15px; margin-bottom:10px;">Separated Stems</div>
                        <div class="stem-track">
                             <i class="fas fa-microphone-alt stem-icon"></i><span class="stem-name">Vocals</span>
                             <div class="stem-controls">
                                <div class="slider-control"><input type="range" min="0" max="100" value="80"><span class="slider-label" style="font-size:11px; margin-top:2px;"><span id="vocalsVolume">80</span>%</span></div>
                                <div class="slider-control"><input type="range" min="-100" max="100" value="0"><span class="slider-label" style="font-size:11px; margin-top:2px;"><span id="vocalsPan">C</span></span></div>
                             </div>
                             <div class="stem-actions"><button class="preview-btn" title="Mute"><i class="fas fa-volume-mute"></i></button><button class="preview-btn" title="Solo"><i class="fas fa-headphones"></i></button></div>
                        </div>
                         <div class="stem-track">
                             <i class="fas fa-drum stem-icon"></i><span class="stem-name">Drums</span>
                             <div class="stem-controls">
                                <div class="slider-control"><input type="range" min="0" max="100" value="75"><span class="slider-label" style="font-size:11px; margin-top:2px;"><span id="drumsVolume">75</span>%</span></div>
                                <div class="slider-control"><input type="range" min="-100" max="100" value="0"><span class="slider-label" style="font-size:11px; margin-top:2px;"><span id="drumsPan">C</span></span></div>
                             </div>
                             <div class="stem-actions"><button class="preview-btn" title="Mute"><i class="fas fa-volume-mute"></i></button><button class="preview-btn" title="Solo"><i class="fas fa-headphones"></i></button></div>
                        </div>
                        <div class="generation-options" style="margin-top:20px;">
                            <button class="generate-btn secondary" id="stemExportAllBtn"><i class="fas fa-file-archive"></i> Export All Stems</button>
                            <button class="generate-btn" id="stemExportMixBtn"><i class="fas fa-file-audio"></i> Export Mixed Audio</button>
                        </div>
                    </div>
                     <button class="simple-btn" id="aiStemSeparateBtn" style="display:none; margin-top:15px; width:100%; justify-content:center;"><i class="fas fa-wand-magic"></i> AI Separate Stems</button>
                </div>

                <div class="content-container" id="home-feed-content">
                    <div class="feed-section">
                        <div class="control-title" style="font-size:18px;"><i class="fas fa-fire"></i> Trending Now</div>
                        <div class="feed-grid" id="trendingTracksFeed">
                            <div class="feed-card"><div class="feed-card-image"><i class="fas fa-music"></i></div><div class="feed-card-content"><div class="feed-card-title">Future Bass Dreams</div><p class="feed-card-desc">By AI_ArtistX - Electronic</p><a href="#" class="feed-card-action">Listen Now <i class="fas fa-play-circle"></i></a></div></div>
                        </div>
                    </div>
                    <div class="feed-section">
                        <div class="control-title" style="font-size:18px;"><i class="fas fa-record-vinyl"></i> New Releases</div>
                        <div class="feed-grid" id="newReleasesFeed"> </div>
                    </div>
                </div>
                
                <div class="content-container" id="explore-genres-content">
                    <div class="control-title" style="font-size:18px; margin-bottom:20px;"><i class="fas fa-compass"></i> Explore Music Genres</div>
                    <div class="genre-explore-grid" id="genreExploreGridContainer">
                        <div class="genre-explore-card" data-genre-explore="Lo-Fi"><i class="fas fa-coffee"></i><h3>Lo-Fi Beats</h3></div>
                    </div>
                    <div class="ai-genre-blender">
                        <div class="control-title" style="font-size:16px;"><i class="fas fa-flask-potion"></i> AI Genre Blender</div>
                        <div class="genre-blend-selects">
                            <select class="select-dropdown" id="genreBlend1"><option value="">Select Genre 1</option></select>
                            <span style="align-self:center; font-size:20px; color:var(--primary);">+</span>
                            <select class="select-dropdown" id="genreBlend2"><option value="">Select Genre 2</option></select>
                        </div>
                        <button class="simple-btn" id="aiBlendGenresBtn" style="width:100%; justify-content:center;"><i class="fas fa-blender-phone"></i> Blend Genres with AI</button>
                    </div>
                </div>

                <div class="content-container" id="global-search-content">
                    <div class="control-title" style="font-size:18px; margin-bottom:10px;"><i class="fas fa-search-dollar"></i> Global Music Search</div>
                    <div class="global-search-filters">
                        <input type="text" id="globalSearchQuery" class="search-bar-small" placeholder="Search tracks, artists, lyrics...">
                        <select class="select-dropdown" id="globalSearchType"><option value="all">All</option><option value="tracks">Tracks</option><option value="artists">Artists</option></select>
                        <input type="number" id="globalSearchBpm" class="search-bar-small" placeholder="BPM (e.g. 120)">
                        <button class="simple-btn" id="executeGlobalSearchBtn"><i class="fas fa-search"></i> Search</button>
                    </div>
                    <div class="search-results-tabs control-group">
                        <div class="tabs-container" id="searchResultsTabsContainer">
                             <button class="tab-button active" data-tab="searchAll"><i class="fas fa-asterisk"></i> All Results</button>
                             <button class="tab-button" data-tab="searchTracks"><i class="fas fa-music"></i> Tracks</button>
                             <button class="tab-button" data-tab="searchArtists"><i class="fas fa-user-music"></i> Artists</button>
                        </div>
                        <div id="searchAll" class="tab-content active"><p>Search results will appear here...</p></div>
                        <div id="searchTracks" class="tab-content"><p>Track-specific results...</p></div>
                        <div id="searchArtists" class="tab-content"><p>Artist-specific results...</p></div>
                    </div>
                </div>
                
                <div class="content-container" id="extend-track-content">
                    <div class="control-title" style="font-size:18px; margin-bottom:20px;"><i class="fas fa-arrows-alt-h"></i> Extend Your Track</div>
                    <div class="control-group">
                        <p style="margin-bottom:10px; font-size:13px;">Select a track from your library to extend:</p>
                        <select class="select-dropdown" id="extendTrackSelector" style="margin-bottom:15px;"><option value="">-- Select Track --</option></select>
                        <div class="control-title" style="font-size:15px;">Extension Options</div>
                        <div class="chip-grid" id="extendOptionsChips" style="margin-bottom:15px;">
                            <div class="chip active" data-extend-type="duration">Extend Duration</div>
                            <div class="chip" data-extend-type="add_intro">Add Intro</div>
                            <div class="chip" data-extend-type="add_outro">Add Outro</div>
                            <div class="chip" data-extend-type="variation">Generate Variation</div>
                        </div>
                        <div class="slider-control" id="extendDurationControl">
                            <label class="slider-label"><span>Extend by (seconds):</span><span id="extendDurationValue">30</span></label>
                            <input type="range" min="10" max="120" value="30" step="5" id="extendDurationSlider">
                        </div>
                        <div class="option-toggle"><span>AI Transition Smoothing</span><label class="toggle-switch"><input type="checkbox" id="aiTransitionSmootherToggle" checked><span class="toggle-slider"></span></label></div>
                        <button class="generate-btn" id="executeExtendTrackBtn" style="margin-top:15px;"><i class="fas fa-wand-magic"></i> Extend with AI</button>
                    </div>
                </div>

                <div class="content-container" id="publish-share-content">
                     <div class="control-title" style="font-size:18px; margin-bottom:20px;"><i class="fas fa-rocket"></i> Publish & Share Track</div>
                     <div class="control-group">
                        <p style="margin-bottom:10px; font-size:13px;">Select a track from your library to publish:</p>
                        <select class="select-dropdown" id="publishTrackSelector" style="margin-bottom:15px;"><option value="">-- Select Track --</option></select>
                        <div class="control-title" style="font-size:15px;">Publishing Details</div>
                        <div class="form-group" style="margin-bottom:10px;">
                            <label for="publishTitle" style="font-size:12px;">Title:</label><input type="text" id="publishTitle" class="textarea-control" style="min-height:auto; padding:8px;">
                        </div>
                        <div class="form-group" style="margin-bottom:10px;">
                            <label for="publishArtist" style="font-size:12px;">Artist Name:</label><input type="text" id="publishArtist" class="textarea-control" style="min-height:auto; padding:8px;">
                        </div>
                         <div class="form-group" style="margin-bottom:10px;">
                            <label for="publishAlbumArt" style="font-size:12px;">Album Art URL (or):</label>
                            <div style="display:flex; gap:10px; align-items:center;">
                                <input type="text" id="publishAlbumArt" class="textarea-control" style="min-height:auto; padding:8px; flex:1;">
                                <button class="simple-btn" id="aiGenerateArtBtn"><i class="fas fa-palette"></i> AI Art</button>
                            </div>
                        </div>
                        <div class="form-group" style="margin-bottom:10px;">
                            <label for="publishDescription" style="font-size:12px;">Description:</label><textarea id="publishDescription" class="textarea-control" rows="2"></textarea>
                        </div>
                        <div class="form-group" style="margin-bottom:15px;">
                            <label for="publishTags" style="font-size:12px;">Tags (comma-separated):</label><input type="text" id="publishTags" class="textarea-control" style="min-height:auto; padding:8px;">
                        </div>
                        <div class="control-title" style="font-size:15px;">Sharing Options</div>
                        <div class="chip-grid" style="margin-bottom:15px;">
                            <div class="chip active"><i class="fas fa-globe-americas"></i> Public on Profile</div>
                            <div class="chip"><i class="fas fa-link"></i> Get Shareable Link</div>
                            <div class="chip"><i class="fab fa-soundcloud"></i> Share to SoundCloud</div>
                        </div>
                        <button class="generate-btn" id="executePublishBtn"><i class="fas fa-upload"></i> Publish Track</button>
                     </div>
                </div>
                
                <div class="content-container" id="notifications-content">
                    <div class="control-title" style="font-size:18px; margin-bottom:10px;"><i class="fas fa-bell"></i> Your Notifications</div>
                    <div class="control-group" id="notificationsList">
                        <div class="notification-item"><i class="fas fa-heart"></i> UserX liked your track "Cosmic Dreams". <small style="margin-left:auto; color:var(--gray);">2h ago</small></div>
                        <div class="notification-item"><i class="fas fa-comment"></i> UserY commented on "Future Bass". <small style="margin-left:auto; color:var(--gray);">5h ago</small></div>
                        <div class="notification-item"><i class="fas fa-bullhorn"></i> New Feature: AI Stem Mastering now available! <small style="margin-left:auto; color:var(--gray);">1d ago</small></div>
                    </div>
                </div>
                <div class="content-container" id="profile-content">
                    <div class="control-title" style="font-size:18px; margin-bottom:10px;"><i class="fas fa-id-card"></i> Edit Your Profile</div>
                    <div class="control-group profile-form">
                        <div class="form-group"><label for="profileAvatar">Avatar URL:</label><input type="text" id="profileAvatar" value="https://i.pravatar.cc/150?u=sunoUser"></div>
                        <div class="form-group"><label for="profileUsername">Username:</label><input type="text" id="profileUsername" value="SunoAI_User"></div>
                        <div class="form-group"><label for="profileBio">Bio:</label><textarea id="profileBio">Loves creating music with AI!</textarea></div>
                        <button class="simple-btn" id="saveProfileBtn"><i class="fas fa-save"></i> Save Profile</button>
                    </div>
                </div>
                <div class="content-container" id="settings-content">
                    <div class="control-title" style="font-size:18px; margin-bottom:10px;"><i class="fas fa-tools"></i> Application Settings</div>
                    <div class="control-group settings-form">
                        <div class="form-group"><label for="settingsTheme">Theme:</label><select id="settingsTheme" class="select-dropdown"><option value="light">Light</option><option value="dark">Dark</option><option value="system">System Default</option></select></div>
                        <div class="form-group"><label for="settingsDefaultVolume">Default Playback Volume:</label><input type="range" id="settingsDefaultVolume" min="0" max="100" value="80"></div>
                        <div class="option-toggle"><span>Email Notifications</span><label class="toggle-switch"><input type="checkbox" checked><span class="toggle-slider"></span></label></div>
                        <button class="simple-btn" id="saveSettingsBtn"><i class="fas fa-save"></i> Save Settings</button>
                    </div>
                </div>
                 <div class="content-container" id="upgrade-plan-content">
                    <div class="control-title" style="font-size:18px; margin-bottom:10px;"><i class="fas fa-level-up-alt"></i> Upgrade Your Plan</div>
                    <div class="subscription-plans">
                        <div class="plan-card"><h3>Free Tier</h3><div class="price">$0<small>/mo</small></div><ul><li><i class="fas fa-check"></i> Limited Generations</li><li><i class="fas fa-check"></i> Basic AI Tools</li><li><i class="fas fa-times"></i> No Stem Export</li></ul><button class="simple-btn" disabled>Current Plan</button></div>
                        <div class="plan-card" style="border-color:var(--primary); border-width:2px;"><h3>Pro Creator</h3><div class="price">$15<small>/mo</small></div><ul><li><i class="fas fa-check"></i> Unlimited Generations</li><li><i class="fas fa-check"></i> All AI Tools</li><li><i class="fas fa-check"></i> Stem Export</li><li><i class="fas fa-check"></i> Priority Support</li></ul><button class="generate-btn" id="upgradeToProBtn">Upgrade to Pro</button></div>
                        <div class="plan-card"><h3>Studio Max</h3><div class="price">$49<small>/mo</small></div><ul><li><i class="fas fa-check"></i> Everything in Pro</li><li><i class="fas fa-check"></i> Advanced Collaboration</li><li><i class="fas fa-check"></i> API Access (Soon)</li></ul><button class="simple-btn" id="upgradeToStudioBtn">Go Studio</button></div>
                    </div>
                </div>
                <div class="content-container" id="help-center-content">
                     <div class="control-title" style="font-size:18px; margin-bottom:10px;"><i class="fas fa-life-ring"></i> Help & Support</div>
                     <div class="control-group">
                        <input type="text" class="search-bar-small" placeholder="Search help topics..." style="width:100%; margin-bottom:15px;">
                        <p><a href="#" class="feed-card-action">FAQ</a> | <a href="#" class="feed-card-action">Tutorials</a> | <a href="#" class="feed-card-action">Contact Support</a></p>
                     </div>
                </div>

            </div> 
        </div> 
    </div> 

    <script>
    // DOM Elements
    const mainHeaderTitle = document.getElementById('mainHeaderTitle');
    const sidebar = document.getElementById('sidebar');
    const menuToggle = document.getElementById('menuToggle');
    const lyricsTextarea = document.getElementById('lyricsTextarea');
    const wordCountDisplay = document.getElementById('wordCountDisplay');
    const charCountDisplay = document.getElementById('charCountDisplay');
    const syllableCountDisplay = document.getElementById('syllableCountDisplay');
    const lyricToneDisplay = document.getElementById('lyricToneDisplay');
    const generatedLyricsDisplay = document.getElementById('generatedLyricsDisplay');
    const waveformContainer = document.getElementById('previewWaveform');
    const libraryTrackGrid = document.getElementById('libraryTrackGrid');
    const libraryCountBadge = document.getElementById('libraryCountBadge');
    const libraryPagination = document.getElementById('libraryPagination');
    const prevPageBtn = document.getElementById('prevPageBtn');
    const nextPageBtn = document.getElementById('nextPageBtn');
    const pageInfo = document.getElementById('pageInfo');
    const libraryFilterGenre = document.getElementById('libraryFilterGenre');
    const stemTracksContainer = document.getElementById('stemTracksContainer');
    const stemMixerUploadArea = document.getElementById('stemMixerUploadArea');
    const aiStemSeparateBtn = document.getElementById('aiStemSeparateBtn');
    const stemMixerFileInput = document.getElementById('stemMixerFileInput');


    let allLibraryTracks = [];
    let currentPage = 1;
    const tracksPerPage = 12; // Number of tracks to show per page

    // --- Initialization & Core Navigation ---
    function initializeApp() {
        setupEventListeners();
        populateLibrary(50); // Populate with more tracks
        renderLibraryPage(currentPage);
        populateGenreFilters();
        updateWaveformDisplay(waveformContainer); // Initial waveform bars
        document.querySelector('.nav-item[data-content="create"]')?.click(); 
        if (lyricsTextarea) lyricsTextarea.dispatchEvent(new Event('input')); 
        
        document.querySelectorAll('.control-group').forEach(group => {
            const firstTabButton = group.querySelector('.tabs-container .tab-button');
            if (firstTabButton) firstTabButton.click();
        });
        console.log("SUNO AI Music Suite v5 Initialized");
    }

    function setupEventListeners() {
        // Sidebar Navigation
        document.querySelectorAll('.nav-item[data-content]').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.nav-item[data-content]').forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');
                document.querySelectorAll('.content-container').forEach(c => c.classList.remove('active'));
                const contentId = this.getAttribute('data-content');
                const targetContent = document.getElementById(`${contentId}-content`); // Corrected ID
                if (targetContent) {
                    targetContent.classList.add('active');
                    const titleText = this.innerText.trim().split('\n')[0]; 
                    mainHeaderTitle.textContent = titleText;
                }
                if (window.innerWidth <= 768 && sidebar.classList.contains('open')) {
                    sidebar.classList.remove('open');
                    menuToggle.innerHTML = '<i class="fas fa-bars"></i>';
                }
            });
        });

        // Mobile Menu Toggle
        if (menuToggle) {
            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('open');
                menuToggle.innerHTML = sidebar.classList.contains('open') ? '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
            });
        }

        // Tabs
        document.querySelectorAll('.tabs-container .tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const parentTabs = button.closest('.tabs-container');
                parentTabs.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                const targetTab = button.getAttribute('data-tab');
                button.closest('.control-group').querySelectorAll('.tab-content').forEach(content => {
                    content.classList.toggle('active', content.id === targetTab);
                });
            });
        });

        // Generic Chip Grid Selector (single select)
        document.querySelectorAll('.chip-grid').forEach(grid => {
            grid.addEventListener('click', function(e) {
                if (e.target.classList.contains('chip')) {
                    const chipsInGroup = this.querySelectorAll('.chip');
                    chipsInGroup.forEach(chip => chip.classList.remove('active'));
                    e.target.classList.add('active');
                }
            });
        });
        
        // Instrument Card Toggle
        document.querySelectorAll('.instrument-card').forEach(card => {
            card.addEventListener('click', () => card.classList.toggle('active'));
        });

        // Sliders Setup
        setupAllSliders();
        
        // Lyrics Area Interaction
        if (lyricsTextarea) lyricsTextarea.addEventListener('input', updateLyricMeta);
        
        // Conceptual Button Clicks
        setupConceptualButtonAlerts();

        // Generation Buttons
        document.querySelectorAll('.generate-btn').forEach(btn => btn.addEventListener('click', simulateTrackGeneration));

        // Library Pagination
        prevPageBtn?.addEventListener('click', () => { if(currentPage > 1) renderLibraryPage(--currentPage); });
        nextPageBtn?.addEventListener('click', () => { 
            const totalPages = Math.ceil(getFilteredLibraryTracks().length / tracksPerPage);
            if(currentPage < totalPages) renderLibraryPage(++currentPage); 
        });
        document.getElementById('librarySearchInput')?.addEventListener('input', () => renderLibraryPage(1));
        document.getElementById('librarySortBy')?.addEventListener('change', () => renderLibraryPage(1));
        libraryFilterGenre?.addEventListener('change', () => renderLibraryPage(1));
        document.getElementById('libraryTagInput')?.addEventListener('input', () => renderLibraryPage(1));


        // Stem Mixer
        document.getElementById('stemMixerBrowseBtn')?.addEventListener('click', () => stemMixerFileInput?.click());
        stemMixerFileInput?.addEventListener('change', handleStemFileSelect);
        aiStemSeparateBtn?.addEventListener('click', simulateStemSeparation);
    }

    function setupAllSliders() {
        setupSliderWithValueDisplay('tempoSlider', 'bpmValue');
        setupSliderWithValueDisplay('energySlider', 'energyValue', {1: 'Low', 2: 'Med-Low', 3: 'Medium', 4: 'Med-High', 5: 'High'});
        setupSliderWithValueDisplay('reverbAmountSlider', 'reverbAmountValue');
        setupSliderWithValueDisplay('delayTimeSlider', 'delayTimeValue');
        setupSliderWithValueDisplay('delayFeedbackSlider', 'delayFeedbackValue');
        setupSliderWithValueDisplay('delayMixSlider', 'delayMixValue');
        setupSliderWithValueDisplay('distortionDriveSlider', 'distortionDriveValue');
        setupSliderWithValueDisplay('aiVariationSlider', 'aiVariationValue', {1: 'Subtle', 2: 'Creative', 3: 'Balanced', 4: 'Bold', 5: 'Wild'});
        setupSliderWithValueDisplay('osc1DetuneSlider', 'osc1DetuneValue');
        setupSliderWithValueDisplay('filterCutoffSlider', 'filterCutoffValue');
        setupSliderWithValueDisplay('filterResonanceSlider', 'filterResonanceValue');
        setupSliderWithValueDisplay('extendDurationSlider', 'extendDurationValue');
        ['eqLow', 'eqMid', 'eqHigh'].forEach(id => setupSliderWithValueDisplay(id, null)); // EQ sliders
    }

    function setupConceptualButtonAlerts() {
        const conceptualButtons = {
            // Create Page
            'analyzeStructureBtn': 'AI Lyric Structure Analysis: Activated!',
            'suggestLineBtn': () => { lyricsTextarea.value += "\nAI Suggested: ... a new path unfolds."; lyricsTextarea.dispatchEvent(new Event('input')); },
            'saveSnippetBtn': 'Lyric Snippet Saved!',
            'loadSnippetBtn': () => { lyricsTextarea.value = "[Verse]\nLoaded a cool snippet about coding all night,\n[Chorus]\nMaking music, shining bright!"; lyricsTextarea.dispatchEvent(new Event('input')); },
            'aiChordProgressionBtn': 'AI Chord Progression Generator: Finding harmonic inspiration!',
            'aiStoryToSongBtn': () => { const story = document.getElementById('storyToSongTextarea')?.value || "a default story"; alert(`AI Story to Song: Crafting for "${story.substring(0,30)}..."`); },
            'applySynthSoundBtn': 'Synth sound preset applied (conceptual)!',
            'remixTrackBtn': 'Remixing track with AI variations...',
            'saveTrackBtn': 'Track saved to library (conceptual)!',
            'trackVersionsBtn': 'Loading track version history... (conceptual)',
            'collaborateTrackBtn': 'Opening collaboration panel... (conceptual)',
            'aiHarmonyBtn': 'AI Harmony Suggestions: Exploring complementary notes!',
            'aiMelodyRefineBtn': 'AI Melody Refiner: Polishing your tune!',
            'importMidiBtn': 'Open file dialog to import MIDI... (conceptual)',
            'exportMidiBtn': 'Exporting current arrangement as MIDI... (conceptual)',
            // Library Page
            'libraryAddToPlaylistBtn': 'Adding selected tracks to playlist... (conceptual)',
            'libraryExportSelectedBtn': 'Exporting selected tracks... (conceptual)',
            'libraryDeleteSelectedBtn': 'Deleting selected tracks... (conceptual - requires selection logic)',
            // Stem Mixer
            'stemExportAllBtn': 'Exporting all stems as ZIP... (conceptual)',
            'stemExportMixBtn': 'Exporting new mix as WAV... (conceptual)',
            // Home Feed
            // (Event listeners for feed cards would go here if they did more than navigate)
            // Explore Genres
            'aiBlendGenresBtn': () => {
                const genre1 = document.getElementById('genreBlend1').value;
                const genre2 = document.getElementById('genreBlend2').value;
                if(genre1 && genre2) alert(`AI Blending ${genre1} + ${genre2} = New Sound! (conceptual)`);
                else alert('Please select two genres to blend.');
            },
            // Global Search
            'executeGlobalSearchBtn': 'Executing global search... (conceptual)',
            // Extend Track
            'executeExtendTrackBtn': 'Extending track with AI... (conceptual)',
            // Publish & Share
            'aiGenerateArtBtn': 'AI Generating Album Art suggestion... (conceptual)',
            'executePublishBtn': 'Publishing track... (conceptual)',
            // Account Pages
            'saveProfileBtn': 'Profile saved! (conceptual)',
            'saveSettingsBtn': 'Settings saved! (conceptual)',
            'upgradeToProBtn': 'Redirecting to Pro upgrade page... (conceptual)',
            'upgradeToStudioBtn': 'Redirecting to Studio Max upgrade page... (conceptual)',
            // Header
            'uploadAudioHeaderBtn': 'Open file dialog to upload audio... (conceptual)',
            'appSettingsIcon': 'Opening application settings panel... (conceptual)',
            'userProfileHeaderIcon': 'Navigating to user profile... (conceptual)',
        };

        for (const id in conceptualButtons) {
            const element = document.getElementById(id);
            if (element) {
                if (typeof conceptualButtons[id] === 'function') {
                    element.addEventListener('click', conceptualButtons[id]);
                } else {
                    element.addEventListener('click', () => alert(conceptualButtons[id]));
                }
            }
        }
    }

    // --- Lyrics Interaction ---
    const lyricStructureRegex = /(\[(Verse\s*\d*|Chorus\s*\d*|Bridge|Intro|Outro|Pre-Chorus|Hook|Solo|Interlude|Adlib|Skit|Section)\])/gi;
    function highlightLyricsInDisplay(text) { 
        return text.replace(lyricStructureRegex, (match, p1, p2) => {
            let className = 'lyrics-highlight-other';
            const tagType = p2.toLowerCase().split(' ')[0];
            if (tagType.startsWith('verse')) className = 'lyrics-highlight-verse';
            else if (tagType.startsWith('chorus') || tagType.startsWith('hook')) className = 'lyrics-highlight-chorus';
            else if (tagType.startsWith('bridge')) className = 'lyrics-highlight-bridge';
            return `<span class="${className}">${p1}</span>`;
        });
    }
    function updateLyricMeta() {
        const text = lyricsTextarea.value;
        const words = text.trim().split(/\s+/).filter(Boolean);
        wordCountDisplay.textContent = words.length;
        charCountDisplay.textContent = text.length;
        
        let syllables = 0; 
        words.forEach(word => {
            word = word.toLowerCase().replace(/[^a-z']/g, '');
            if(word.length === 0) return;
            if(word.length <= 3 && word.length > 0) { syllables += 1; return; }
            word = word.replace(/(?:[^laeiouy]es|ed|[^laeiouy]e)$/, '');
            word = word.replace(/^y/, '');
            const vowelMatches = word.match(/[aeiouy]{1,2}/g);
            syllables += vowelMatches ? vowelMatches.length : (word.length > 0 ? 1 : 0);
        });
        syllableCountDisplay.textContent = syllables;

        if (text.toLowerCase().includes('happy') || text.toLowerCase().includes('joy') || text.toLowerCase().includes('bright')) {
            lyricToneDisplay.innerHTML = '<i class="fas fa-face-grin-stars" style="color: var(--warning);"></i><span>Joyful</span>';
        } else if (text.toLowerCase().includes('sad') || text.toLowerCase().includes('cry') || text.toLowerCase().includes('tear')) {
            lyricToneDisplay.innerHTML = '<i class="fas fa-face-sad-cry" style="color: var(--info);"></i><span>Sad</span>';
        } else if (text.toLowerCase().includes('angry') || text.toLowerCase().includes('rage') || text.toLowerCase().includes('hate')) {
            lyricToneDisplay.innerHTML = '<i class="fas fa-face-angry" style="color: var(--danger);"></i><span>Angry</span>';
        } else {
            lyricToneDisplay.innerHTML = '<i class="fas fa-face-meh" style="color: var(--gray);"></i><span>Neutral</span>';
        }
    }
        
    // --- Waveform Display ---
    function updateWaveformDisplay(container, numBars = 30) {
        if (!container) return;
        const waveformDisplay = container.querySelector('.waveform');
        if (!waveformDisplay) return;

        waveformDisplay.innerHTML = ''; 
        for (let i = 0; i < numBars; i++) {
            const bar = document.createElement('div');
            bar.classList.add('waveform-bar');
            bar.style.animationDelay = `-${(Math.random() * 1.2).toFixed(2)}s`;
            waveformDisplay.appendChild(bar);
        }
    }
    function startWaveformAnimation(container) { if (container) container.classList.add('animating'); }
    function stopWaveformAnimation(container) { if (container) container.classList.remove('animating'); }
    
    // --- Track Generation Simulation ---
    function simulateTrackGeneration() {
        const btn = this; // `this` refers to the clicked button
        const isQuick = btn.classList.contains('secondary');
        const originalHTML = btn.innerHTML;
        btn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${isQuick ? 'Quick Generating...' : 'Studio Generating...'}`;
        document.querySelectorAll('.generate-btn').forEach(b => b.disabled = true);

        setTimeout(() => {
            btn.innerHTML = originalHTML;
            document.querySelectorAll('.generate-btn').forEach(b => b.disabled = false);
            const previewTitleEl = document.querySelector('.preview-container .preview-title');
            previewTitleEl.textContent = 'âœ¨ Track Ready for Preview!';
            previewTitleEl.style.color = 'var(--success)';
            
            const selectedGenre = document.querySelector('.genre-card.active .genre-name')?.textContent || 'New Genre';
            const selectedMood = document.querySelector('#moodChips .chip.active')?.textContent || 'Unique Mood';
            generatedLyricsDisplay.innerHTML = highlightLyricsInDisplay(`[Verse 1]\nA fresh ${selectedGenre.toLowerCase()} track, with a ${selectedMood.toLowerCase()} vibe,\nAI's magic, now alive.\n\n[Chorus]\nBeats are bumping, melodies soar,\nMusic's power, explore some more!`);
            
            updateWaveformDisplay(waveformContainer); 
            startWaveformAnimation(waveformContainer);

            setTimeout(() => {
                previewTitleEl.textContent = "Track Preview";
                previewTitleEl.style.color = '';
            }, 3000);
        }, isQuick ? 1500 : 3500);
    }

    // --- Library Functionality ---
    function populateLibrary(numberOfTracks = 30) {
        allLibraryTracks = [];
        const genres = ["Electronic", "Pop", "Rock", "Hip Hop", "Ambient", "Classical", "Jazz", "Reggae", "Lo-Fi", "Synthwave"];
        const moods = ["Upbeat", "Chill", "Energetic", "Melancholic", "Dark", "Epic", "Peaceful", "Mysterious", "Romantic"];
        const titles = ["Cosmic Echoes", "Midnight Drive", "Sunset Groove", "City Lights", "Ocean Depths", "Forest Whisper", "Neon Dreams", "Starlight Sonata", "Quantum Leap", "Retro Future", "Silent Stars", "Lost Temple", "Urban Flow", "Island Breeze", "Digital Nomad", "Chrome Waves", "Velvet Night", "Solar Flare", "Lunar Tides", "Crystal Caves"];
        const commonTags = ["instrumental", "vocal", "chill", "focus", "workout", "party", "relax", "arp", "synth", "drums", "bass", "piano", "guitar"];

        for (let i = 0; i < numberOfTracks; i++) {
            const creationDate = new Date(Date.now() - Math.floor(Math.random() * 30) * 24 * 60 * 60 * 1000); // Within last 30 days
            const trackTags = [];
            const numTags = Math.floor(Math.random() * 4) + 1; // 1 to 4 tags
            for(let t=0; t<numTags; t++) {
                trackTags.push(commonTags[Math.floor(Math.random() * commonTags.length)]);
            }

            allLibraryTracks.push({
                id: `track_${Date.now()}_${i}`,
                title: titles[Math.floor(Math.random() * titles.length)] + (i % 5 === 0 ? " Remix" : "") + (i % 3 === 0 ? " (AI Edit)" : ""),
                genre: genres[Math.floor(Math.random() * genres.length)],
                mood: moods[Math.floor(Math.random() * moods.length)],
                duration: `${Math.floor(Math.random() * 3) + 2}:${String(Math.floor(Math.random() * 60)).padStart(2, '0')}`,
                coverArt: `https://picsum.photos/seed/${i+100}/200/200`, // Placeholder images
                plays: Math.floor(Math.random() * 5000),
                likes: Math.floor(Math.random() * 500),
                dateAdded: creationDate.toISOString().split('T')[0],
                tags: [...new Set(trackTags)] // Ensure unique tags
            });
        }
        libraryCountBadge.textContent = allLibraryTracks.length;
    }

    function getFilteredLibraryTracks() {
        const searchTerm = document.getElementById('librarySearchInput')?.value.toLowerCase() || "";
        const sortBy = document.getElementById('librarySortBy')?.value || "date_desc";
        const filterGenre = libraryFilterGenre?.value || "";
        const filterTag = document.getElementById('libraryTagInput')?.value.toLowerCase() || "";

        let filtered = allLibraryTracks.filter(track => {
            const matchesSearch = track.title.toLowerCase().includes(searchTerm) || track.genre.toLowerCase().includes(searchTerm) || track.mood.toLowerCase().includes(searchTerm);
            const matchesGenre = filterGenre ? track.genre === filterGenre : true;
            const matchesTag = filterTag ? track.tags.some(tag => tag.toLowerCase().includes(filterTag)) : true;
            return matchesSearch && matchesGenre && matchesTag;
        });

        // Sorting
        switch(sortBy) {
            case "date_asc": filtered.sort((a,b) => new Date(a.dateAdded) - new Date(b.dateAdded)); break;
            case "title_asc": filtered.sort((a,b) => a.title.localeCompare(b.title)); break;
            case "plays_desc": filtered.sort((a,b) => b.plays - a.plays); break;
            default: filtered.sort((a,b) => new Date(b.dateAdded) - new Date(a.dateAdded)); // date_desc
        }
        return filtered;
    }

    function renderLibraryPage(page) {
        if (!libraryTrackGrid) return;
        currentPage = page;
        const filteredTracks = getFilteredLibraryTracks();
        const totalPages = Math.ceil(filteredTracks.length / tracksPerPage);

        libraryTrackGrid.innerHTML = ''; // Clear previous tracks
        
        const startIndex = (page - 1) * tracksPerPage;
        const endIndex = startIndex + tracksPerPage;
        const tracksToDisplay = filteredTracks.slice(startIndex, endIndex);

        if (tracksToDisplay.length === 0 && filteredTracks.length > 0) { // If current page is empty but there are tracks (e.g. after filtering)
            currentPage = 1;
            renderLibraryPage(1); // Re-render from page 1
            return;
        }
        if (tracksToDisplay.length === 0) {
             libraryTrackGrid.innerHTML = '<p style="grid-column: 1 / -1; text-align:center; color: var(--gray);">No tracks found matching your criteria.</p>';
        }


        tracksToDisplay.forEach(track => {
            const card = document.createElement('div');
            card.classList.add('track-card');
            card.innerHTML = `
                <div class="track-cover-large" style="background-image: url('${track.coverArt}'); background-size:cover; background-position:center;">
                    <div class="track-actions-overlay">
                        <button class="track-action-btn" title="Play"><i class="fas fa-play"></i></button>
                        <button class="track-action-btn" title="Add to queue"><i class="fas fa-plus"></i></button>
                        <button class="track-action-btn" title="More options"><i class="fas fa-ellipsis-h"></i></button>
                    </div>
                </div>
                <div class="track-info-large">
                    <div>
                        <div class="track-title" title="${track.title}">${track.title}</div>
                        <div class="track-meta">
                            <span>${track.genre} - ${track.mood}</span>
                            <span class="duration">${track.duration}</span>
                        </div>
                        <div class="track-stats">
                            <span><i class="fas fa-play"></i> ${track.plays.toLocaleString()}</span>
                            <span><i class="fas fa-heart"></i> ${track.likes.toLocaleString()}</span>
                            <span><i class="fas fa-calendar-alt"></i> ${track.dateAdded}</span>
                        </div>
                    </div>
                    <div class="track-tags">
                        ${track.tags.map(tag => `<span class="track-tag">${tag}</span>`).join('')}
                    </div>
                </div>
            `;
            card.addEventListener('click', (e) => {
                if (!e.target.closest('.track-action-btn')) { // Don't trigger if an action button was clicked
                    alert(`Playing track: ${track.title} (conceptual)`);
                }
            });
            libraryTrackGrid.appendChild(card);
        });

        // Update pagination controls
        pageInfo.textContent = `Page ${currentPage} of ${totalPages || 1}`;
        prevPageBtn.disabled = currentPage === 1;
        nextPageBtn.disabled = currentPage === totalPages || totalPages === 0;
    }

    function populateGenreFilters() {
        if (!libraryFilterGenre) return;
        const uniqueGenres = [...new Set(allLibraryTracks.map(track => track.genre))].sort();
        uniqueGenres.forEach(genre => {
            const option = document.createElement('option');
            option.value = genre;
            option.textContent = genre;
            libraryFilterGenre.appendChild(option);
        });
        // Also populate for AI Genre Blender
        const genreBlend1 = document.getElementById('genreBlend1');
        const genreBlend2 = document.getElementById('genreBlend2');
        const genreExploreGridContainer = document.getElementById('genreExploreGridContainer');

        if(genreBlend1 && genreBlend2) {
            uniqueGenres.forEach(genre => {
                let opt1 = document.createElement('option'); opt1.value = genre; opt1.textContent = genre; genreBlend1.appendChild(opt1);
                let opt2 = document.createElement('option'); opt2.value = genre; opt2.textContent = genre; genreBlend2.appendChild(opt2);
            });
        }
        if (genreExploreGridContainer) {
            genreExploreGridContainer.innerHTML = ''; // Clear defaults
            uniqueGenres.slice(0,12).forEach(genre => { // Show a subset
                const card = document.createElement('div');
                card.classList.add('genre-explore-card');
                card.dataset.genreExplore = genre;
                card.innerHTML = `<i class="fas fa-headphones-alt"></i><h3>${genre}</h3>`;
                card.addEventListener('click', () => alert(`Exploring ${genre} genre details... (conceptual)`));
                genreExploreGridContainer.appendChild(card);
            });
        }
    }
    
    // --- Stem Mixer Functionality ---
    function handleStemFileSelect(event) {
        const file = event.target.files[0];
        if (file) {
            alert(`File "${file.name}" selected for stem separation. Click "AI Separate Stems".`);
            stemMixerUploadArea.style.display = 'none';
            aiStemSeparateBtn.style.display = 'flex'; // Show the separate button
            // In a real app, you'd probably show a loading indicator for the file.
        }
    }

    function simulateStemSeparation() {
        aiStemSeparateBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Separating Stems...`;
        aiStemSeparateBtn.disabled = true;

        setTimeout(() => {
            stemTracksContainer.style.display = 'block';
            aiStemSeparateBtn.innerHTML = `<i class="fas fa-wand-magic"></i> AI Separate Stems`;
            aiStemSeparateBtn.disabled = false;
            aiStemSeparateBtn.style.display = 'none'; // Hide after separation
            alert('Stems separated successfully! (Conceptual)');
            // Populate stemTracksContainer with actual stem controls if needed
        }, 2500);
    }


    // --- Slider Setup Utility ---
    function setupSliderWithValueDisplay(sliderId, displayId, valueMap) {
        const slider = document.getElementById(sliderId);
        const display = document.getElementById(displayId);
        if (slider && display) {
            const updateDisplay = () => {
                display.textContent = valueMap ? valueMap[slider.value] : slider.value;
            };
            slider.addEventListener('input', updateDisplay);
            updateDisplay(); 
        } else if (slider && !display) { 
            // console.log(`Slider ${sliderId} found, no display.`);
        } else {
            // console.warn(`Slider or display not found for: ${sliderId}`);
        }
    }
    
    // --- Generic Click Alerter for Placeholders ---
    function addClickAlert(elementId, message) {
        const element = document.getElementById(elementId);
        if (element) {
            element.addEventListener('click', () => alert(message));
        }
    }

    // Initialize the application
    document.addEventListener('DOMContentLoaded', initializeApp);

    </script>
</body>
</html>